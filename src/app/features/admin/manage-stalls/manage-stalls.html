<div class="min-h-screen bg-gray-100 py-8">
  <div class="max-w-7xl mx-auto px-4">

    <!-- Header -->
    <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-8">
      <div>
        <a routerLink="/admin" class="text-blue-600 hover: underline mb-2 inline-block">â† Back to Admin</a>
        <h1 class="text-3xl font-bold text-gray-900">Manage Stalls ğŸª</h1>
        <p class="text-gray-600 mt-1">View, edit, and manage all stalls</p>
      </div>
      <a routerLink="/admin/stalls/create" 
         class="mt-4 md:mt-0 inline-flex items-center px-6 py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition shadow-lg">
        â• Create New Stall
      </a>
    </div>

    <!-- Stats Cards -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
      <div class="bg-white rounded-xl shadow p-4 text-center hover:shadow-lg transition">
        <p class="text-2xl font-bold text-gray-900">{{ stats.total }}</p>
        <p class="text-sm text-gray-500">Total Stalls</p>
      </div>
      <div class="bg-white rounded-xl shadow p-4 text-center hover:shadow-lg transition">
        <p class="text-2xl font-bold text-red-600">{{ stats.active }}</p>
        <p class="text-sm text-gray-500">ğŸ”´ Active</p>
      </div>
      <div class="bg-white rounded-xl shadow p-4 text-center hover:shadow-lg transition">
        <p class="text-2xl font-bold text-green-600">{{ stats. available }}</p>
        <p class="text-sm text-gray-500">ğŸŸ¢ Available</p>
      </div>
      <div class="bg-white rounded-xl shadow p-4 text-center hover:shadow-lg transition">
        <p class="text-2xl font-bold text-gray-600">{{ stats.closed }}</p>
        <p class="text-sm text-gray-500">âš« Closed</p>
      </div>
    </div>

    <!-- Search & Filters -->
    <div class="bg-white rounded-xl shadow-lg mb-6">
      <div class="p-4 border-b">
        <div class="relative">
          <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">ğŸ”</span>
          <input 
            type="text" 
            [(ngModel)]="searchQuery"
            (ngModelChange)="onSearchChange()"
            placeholder="Search by name, category, or location..."
            class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
          >
        </div>
      </div>

      <!-- Tabs -->
      <div class="flex border-b overflow-x-auto">
        @for (tab of tabs; track tab. id) {
          <button
            (click)="setActiveTab(tab.id)"
            [ngClass]="activeTab === tab.id ? 'border-b-2 border-blue-600 text-blue-600 bg-blue-50' : 'text-gray-500 hover:bg-gray-50'"
            class="flex-1 min-w-max px-6 py-4 font-medium transition flex items-center justify-center gap-2"
          >
            <span>{{ tab.icon }}</span>
            <span>{{ tab. label }}</span>
            @if (tab.id === 'ACTIVE' && stats.active > 0) {
              <span class="px-2 py-0.5 bg-red-500 text-white text-xs rounded-full">{{ stats.active }}</span>
            }
          </button>
        }
      </div>

      <!-- Stalls Grid -->
      <div class="p-6">
        @if (isLoading) {
          <div class="flex justify-center py-12">
            <div class="w-12 h-12 border-4 border-blue-200 rounded-full animate-spin border-t-blue-600"></div>
          </div>
        } @else if (filteredStalls.length > 0) {
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            @for (stall of filteredStalls; track stall.stallId) {
              <div class="bg-gray-50 rounded-xl overflow-hidden hover:shadow-xl transition-all duration-300 border border-gray-200">
                <!-- Stall Image -->
                <div class="h-40 bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center relative">
                  @if (stall. image) {
                    <img [src]="stall.image" class="w-full h-full object-cover" alt="{{ stall.stallName }}">
                  } @else {
                    <span class="text-5xl">ğŸª</span>
                  }
                  <!-- Status Badge -->
                  <span class="absolute top-3 right-3 px-3 py-1 rounded-full text-xs font-medium flex items-center gap-1" 
                        [ngClass]="getStatusBadge(stall.status || 'AVAILABLE').class">
                    <span>{{ getStatusBadge(stall.status || 'AVAILABLE').icon }}</span>
                    <span>{{ getStatusBadge(stall.status || 'AVAILABLE').label }}</span>
                  </span>
                  <!-- Stall Number Badge -->
                  <span class="absolute top-3 left-3 px-2 py-1 bg-black/50 text-white rounded-lg text-xs font-bold">
                    #{{ stall.stallNo }}
                  </span>
                </div>

                <!-- Stall Info -->
                <div class="p-4">
                  <div class="flex items-start justify-between mb-2">
                    <div>
                      <h3 class="font-bold text-gray-900 text-lg">{{ stall.stallName }}</h3>
                      <p class="text-sm text-gray-500">{{ stall.category }}</p>
                    </div>
                  </div>

                  <p class="text-sm text-gray-500 mb-3 flex items-center gap-1">
                    <span>ğŸ“</span>
                    <span>{{ stall.location }}</span>
                  </p>

                  <!-- Prices -->
                  <div class="flex items-center justify-between mb-3 py-2 px-3 bg-white rounded-lg">
                    <div>
                      <p class="text-xs text-gray-500">Base Price</p>
                      <p class="font-bold text-gray-900">â‚¹{{ stall. basePrice | number }}</p>
                    </div>
                    <div class="text-right">
                      <p class="text-xs text-gray-500">Current Bid</p>
                      <p class="font-bold text-green-600">â‚¹{{ stall.currentHighestBid || stall.basePrice | number }}</p>
                    </div>
                  </div>

                  <!-- Dates -->
                  <div class="text-xs text-gray-500 mb-4 space-y-1">
                    <p>ğŸ• Start: {{ stall.biddingStart }}</p>
                    <p>ğŸ End: {{ stall.biddingEnd }}</p>
                  </div>

                  <!-- Action Buttons -->
                  <div class="flex flex-wrap gap-2">
                    <!-- Start/End Auction -->
                    @if (stall. status === 'AVAILABLE') {
                      <button 
                        (click)="startAuction(stall, $event)"
                        class="flex-1 bg-green-600 text-white py-2 px-3 rounded-lg text-sm font-semibold hover:bg-green-700 transition flex items-center justify-center gap-1">
                        <span>ğŸ”´</span> Start Auction
                      </button>
                    }
                    @if (stall. status === 'ACTIVE') {
                      <button 
                        (click)="endAuction(stall, $event)"
                        class="flex-1 bg-orange-600 text-white py-2 px-3 rounded-lg text-sm font-semibold hover:bg-orange-700 transition flex items-center justify-center gap-1">
                        <span>â¹ï¸</span> End Auction
                      </button>
                    }
                    
                    <!-- View Button -->
                    <a [routerLink]="['/stalls', stall.stallId]"
                       class="px-3 py-2 bg-blue-600 text-white rounded-lg text-sm font-semibold hover:bg-blue-700 transition flex items-center gap-1">
                      <span>ğŸ‘ï¸</span>
                    </a>
                    
                    <!-- Edit Button -->
                    <a [routerLink]="['/admin/stalls/edit', stall. stallId]"
                       class="px-3 py-2 bg-yellow-500 text-white rounded-lg text-sm font-semibold hover:bg-yellow-600 transition flex items-center gap-1">
                      <span>âœï¸</span>
                    </a>
                    
                    <!-- Delete Button -->
                    <button 
                      (click)="openDeleteModal(stall, $event)"
                      class="px-3 py-2 bg-red-500 text-white rounded-lg text-sm font-semibold hover:bg-red-600 transition flex items-center gap-1">
                      <span>ğŸ—‘ï¸</span>
                    </button>
                  </div>
                </div>
              </div>
            }
          </div>
        } @else {
          <div class="text-center py-12">
            <span class="text-6xl block mb-4">ğŸª</span>
            <h3 class="text-xl font-semibold text-gray-900 mb-2">No stalls found</h3>
            <p class="text-gray-500 mb-6">
              @if (activeTab === 'ALL' && ! searchQuery) {
                No stalls have been created yet. Create your first stall! 
              } @else if (activeTab === 'ACTIVE') {
                No active auctions at the moment.
              } @else if (activeTab === 'AVAILABLE') {
                No available stalls.  Create new stalls to get started. 
              } @else if (activeTab === 'CLOSED') {
                No closed auctions yet. 
              } @else {
                No stalls match your search criteria.
              }
            </p>
            <a routerLink="/admin/stalls/create" 
               class="inline-flex items-center px-6 py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition">
              â• Create New Stall
            </a>
          </div>
        }
      </div>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
@if (showDeleteModal && stallToDelete) {
  <div class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4" (click)="closeDeleteModal()">
    <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-6" (click)="$event.stopPropagation()">
      <div class="text-center">
        <!-- Warning Icon -->
        <div class="w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
          <span class="text-4xl">âš ï¸</span>
        </div>
        
        <h2 class="text-xl font-bold text-gray-900 mb-2">Delete Stall? </h2>
        
        <div class="bg-gray-50 rounded-lg p-4 mb-4 text-left">
          <p class="font-semibold text-gray-900">{{ stallToDelete. stallName }}</p>
          <p class="text-sm text-gray-500">Stall #{{ stallToDelete. stallNo }} â€¢ {{ stallToDelete. category }}</p>
          <p class="text-sm text-gray-500">ğŸ“ {{ stallToDelete.location }}</p>
        </div>
        
        <p class="text-gray-500 mb-6">
          This action cannot be undone. All bids and data associated with this stall will be permanently deleted. 
        </p>
        
        <div class="flex gap-4">
          <button 
            (click)="closeDeleteModal()"
            class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-300 transition">
            Cancel
          </button>
          <button 
            (click)="confirmDelete()"
            [disabled]="isDeleting"
            class="flex-1 bg-red-600 text-white py-3 rounded-lg font-semibold hover:bg-red-700 transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center">
            @if (isDeleting) {
              <svg class="animate-spin -ml-1 mr-2 h-5 w-5 text-white" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
              </svg>
              Deleting... 
            } @else {
              ğŸ—‘ï¸ Delete Stall
            }
          </button>
        </div>
      </div>
    </div>
  </div>
}