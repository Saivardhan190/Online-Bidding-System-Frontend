<div class="min-h-screen bg-gray-50 py-8">
  <div class="max-w-7xl mx-auto px-4">
    
    <!-- Back Navigation -->
    <div class="mb-6">
      <a routerLink="/dashboard" class="inline-flex items-center text-blue-600 hover:text-blue-700 transition font-medium">
        <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
        </svg>
        Back to Dashboard
      </a>
    </div>

    <!-- Header -->
    <div class="mb-8">
      <h1 class="text-3xl font-bold text-gray-900 flex items-center gap-2">
        <span>üè∑Ô∏è</span>
        <span>My Bids</span>
      </h1>
      <p class="text-gray-600 mt-1">Track all your auction bids in one place</p>
    </div>

    <!-- Loading State -->
    @if (isLoading) {
      <div class="flex justify-center py-12">
        <div class="text-center">
          <div class="w-16 h-16 border-4 border-blue-200 rounded-full animate-spin border-t-blue-600 mx-auto mb-4"></div>
          <p class="text-gray-600 font-medium">Loading your bids...</p>
        </div>
      </div>
    }

    <!-- Error State -->
    @if (error && !isLoading) {
      <div class="bg-red-50 border border-red-200 rounded-xl p-8 text-center">
        <span class="text-5xl mb-4 block">‚ö†Ô∏è</span>
        <h2 class="text-xl font-bold text-red-900 mb-2">Error Loading Bids</h2>
        <p class="text-red-700 mb-6">{{ error }}</p>
        <div class="flex justify-center gap-3">
          <button (click)="retryLoad()" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-medium">
            üîÑ Try Again
          </button>
          <a routerLink="/dashboard" class="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition font-medium">
            ‚Üê Back to Dashboard
          </a>
        </div>
      </div>
    }

    <!-- Main Content (Only show if not loading and no error) -->
    @if (!isLoading && !error) {
      
      <!-- Stats Cards -->
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
        <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-blue-500">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-gray-600 mb-1">Total Bids</p>
              <p class="text-3xl font-bold text-gray-900">{{ stats.total }}</p>
            </div>
            <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
              <span class="text-2xl">üéØ</span>
            </div>
          </div>
        </div>

        <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-green-500">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-gray-600 mb-1">Active Bids</p>
              <p class="text-3xl font-bold text-green-600">{{ stats.active }}</p>
            </div>
            <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center">
              <span class="text-2xl">üî¥</span>
            </div>
          </div>
        </div>

        <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-yellow-500">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-gray-600 mb-1">Won</p>
              <p class="text-3xl font-bold text-yellow-600">{{ stats.won }}</p>
            </div>
            <div class="w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center">
              <span class="text-2xl">üèÜ</span>
            </div>
          </div>
        </div>

        <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-purple-500">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-gray-600 mb-1">Total Spent</p>
              <p class="text-2xl font-bold text-purple-600">‚Çπ{{ stats.totalSpent | number }}</p>
            </div>
            <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center">
              <span class="text-2xl">üí∞</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Filters -->
      <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
        
        <!-- Filter Tabs -->
        <div class="flex flex-wrap gap-2 mb-4">
          @for (tab of tabs; track tab.id) {
            <button 
              (click)="setActiveTab(tab.id)"
              [ngClass]="activeTab === tab.id ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'"
              class="px-4 py-2 rounded-lg font-medium transition">
              {{ tab.icon }} {{ tab.label }}
              @if (tab.id === 'all') {
                ({{ stats.total }})
              } @else if (tab.id === 'active') {
                ({{ stats.active }})
              } @else if (tab.id === 'won') {
                ({{ stats.won }})
              } @else if (tab.id === 'lost') {
                ({{ stats.lost }})
              }
            </button>
          }
        </div>

        <!-- Search and Sort -->
        <div class="flex flex-col sm:flex-row gap-4">
          <div class="flex-1">
            <input 
              type="text" 
              [(ngModel)]="searchQuery"
              (input)="onSearchChange()"
              placeholder="üîç Search by stall name..."
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            >
          </div>
          <div class="flex items-center gap-2">
            <label class="text-sm font-medium text-gray-700 whitespace-nowrap">Sort by:</label>
            <select 
              [(ngModel)]="sortBy" 
              (change)="onSortChange()" 
              class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
              <option value="recent">Most Recent</option>
              <option value="amount-high">Highest Amount</option>
              <option value="amount-low">Lowest Amount</option>
            </select>
          </div>
        </div>

        <!-- Results Count -->
        <div class="flex items-center justify-between mt-4 pt-4 border-t">
          <p class="text-sm text-gray-600">
            Showing <span class="font-bold">{{ filteredBids.length }}</span> of <span class="font-bold">{{ allBids.length }}</span> bids
          </p>
          @if (searchQuery || activeTab !== 'all') {
            <button (click)="clearFilters()" class="text-sm text-red-600 hover:text-red-700 font-medium">
              üóëÔ∏è Clear Filters
            </button>
          }
        </div>
      </div>

      <!-- Empty State -->
      @if (filteredBids.length === 0) {
        <div class="bg-white rounded-xl shadow-lg p-12 text-center">
          <span class="text-6xl mb-4 block">
            @if (searchQuery) {
              üîç
            } @else if (activeTab === 'active') {
              üî¥
            } @else if (activeTab === 'won') {
              üèÜ
            } @else if (activeTab === 'lost') {
              üòî
            } @else {
              üéØ
            }
          </span>
          <h2 class="text-2xl font-bold text-gray-900 mb-2">
            @if (allBids.length === 0) {
              No Bids Yet
            } @else if (searchQuery) {
              No Matching Bids Found
            } @else if (activeTab === 'active') {
              No Active Bids
            } @else if (activeTab === 'won') {
              No Won Bids Yet
            } @else if (activeTab === 'lost') {
              No Lost Bids
            } @else {
              No Bids Found
            }
          </h2>
          <p class="text-gray-600 mb-6">
            @if (allBids.length === 0) {
              Start bidding on stalls to see them here
            } @else if (searchQuery) {
              Try adjusting your search criteria
            } @else {
              Try changing filters or search criteria
            }
          </p>
          @if (allBids.length === 0) {
            <a routerLink="/stalls" class="inline-block px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-medium">
              Browse Stalls ‚Üí
            </a>
          } @else {
            <button (click)="clearFilters()" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-medium">
              Clear Filters
            </button>
          }
        </div>
      }

      <!-- Bids List -->
      @if (filteredBids.length > 0) {
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          @for (bid of filteredBids; track bid.bidId) {
            <div class="bg-white rounded-xl shadow-lg overflow-hidden hover:shadow-xl transition-all duration-300 border-l-4"
                 [ngClass]="{
                   'border-green-500': bid.status === 'ACTIVE',
                   'border-yellow-500': bid.status === 'WON',
                   'border-gray-400': bid.status === 'LOST'
                 }">
              
              <!-- Card Content -->
              <div class="p-6">
                
                <!-- Header -->
                <div class="flex items-start justify-between mb-4">
                  <div class="flex-1">
                    <h3 class="text-xl font-bold text-gray-900 mb-1">{{ getBidStallName(bid) }}</h3>
                    <p class="text-sm text-gray-500">Stall ID: #{{ bid.stallId }}</p>
                  </div>
                  <span class="px-3 py-1 rounded-full text-xs font-bold border-2" 
                        [ngClass]="getStatusBadge(bid).class">
                    {{ getStatusBadge(bid).icon }} {{ getStatusBadge(bid).label }}
                  </span>
                </div>

                <!-- Bid Amount -->
                <div class="bg-gray-50 rounded-lg p-4 mb-4">
                  <div class="flex items-center justify-between mb-2">
                    <span class="text-sm text-gray-600">Your Bid Amount</span>
                    <span class="text-2xl font-bold text-blue-600">‚Çπ{{ bid.biddedPrice | number }}</span>
                  </div>
                  <div class="flex items-center justify-between text-sm">
                    <span class="text-gray-500">{{ formatDate(bid.bidTime) }}</span>
                    <span class="text-gray-400 text-xs">{{ formatFullDate(bid.bidTime) }}</span>
                  </div>
                </div>

                <!-- Status Message -->
                @if (bid.status === 'ACTIVE' && isWinning(bid)) {
                  <div class="bg-green-50 border border-green-200 rounded-lg p-3 mb-4">
                    <p class="text-sm text-green-800 flex items-center gap-2">
                      <span class="text-lg">üéâ</span>
                      <span class="font-medium">You're currently winning this auction!</span>
                    </p>
                  </div>
                } @else if (bid.status === 'ACTIVE' && !isWinning(bid)) {
                  <div class="bg-orange-50 border border-orange-200 rounded-lg p-3 mb-4">
                    <p class="text-sm text-orange-800 flex items-center gap-2">
                      <span class="text-lg">‚ö†Ô∏è</span>
                      <span class="font-medium">You've been outbid. Place a higher bid to win!</span>
                    </p>
                  </div>
                } @else if (bid.status === 'WON') {
                  <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-4">
                    <p class="text-sm text-yellow-800 flex items-center gap-2">
                      <span class="text-lg">üèÜ</span>
                      <span class="font-medium">Congratulations! You won this auction!</span>
                    </p>
                  </div>
                } @else if (bid.status === 'LOST') {
                  <div class="bg-gray-50 border border-gray-200 rounded-lg p-3 mb-4">
                    <p class="text-sm text-gray-700 flex items-center gap-2">
                      <span class="text-lg">üòî</span>
                      <span class="font-medium">This auction ended. Better luck next time!</span>
                    </p>
                  </div>
                }

                <!-- Actions -->
                <div class="flex gap-2">
                  <a [routerLink]="['/stalls', bid.stallId]" 
                     class="flex-1 text-center py-2 px-4 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition font-medium text-sm">
                    View Details
                  </a>
                  @if (bid.status === 'ACTIVE' && !isWinning(bid)) {
                    <a [routerLink]="['/stalls', bid.stallId]" 
                       class="flex-1 text-center py-2 px-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-medium text-sm">
                      Bid Again ‚Üí
                    </a>
                  }
                </div>
              </div>
            </div>
          }
        </div>
      }

    }

  </div>
</div>